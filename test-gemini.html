<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Gemini Evaluation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-case {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
        }
        .correct {
            background-color: #d4edda;
            color: #155724;
        }
        .incorrect {
            background-color: #f8d7da;
            color: #721c24;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .loading {
            color: #666;
            font-style: italic;
        }
    </style>
</head>
<body>
    <h1>Test Gemini Evaluation - Written Answers</h1>
    
    <div class="test-case">
        <h3>Test 1: "one over two" for 1/2</h3>
        <p><strong>Question:</strong> Convert 50% to a fraction in its simplest form.</p>
        <p><strong>Correct Answer:</strong> 1/2</p>
        <p><strong>Student Answer:</strong> one over two</p>
        <button onclick="testCase1()">Test This</button>
        <div id="result1"></div>
    </div>

    <div class="test-case">
        <h3>Test 2: "half" for 1/2</h3>
        <p><strong>Question:</strong> Convert 50% to a fraction in its simplest form.</p>
        <p><strong>Correct Answer:</strong> 1/2</p>
        <p><strong>Student Answer:</strong> half</p>
        <button onclick="testCase2()">Test This</button>
        <div id="result2"></div>
    </div>

    <div class="test-case">
        <h3>Test 3: "fifty percent" for 50%</h3>
        <p><strong>Question:</strong> What is 50% as a percentage?</p>
        <p><strong>Correct Answer:</strong> 50%</p>
        <p><strong>Student Answer:</strong> fifty percent</p>
        <button onclick="testCase3()">Test This</button>
        <div id="result3"></div>
    </div>

    <script>
        const API_KEY = 'AIzaSyAq76x1Ov2p3MOb5um523Iepjo0yOoPUEM';

        async function evaluateWithGemini(question, hint, correctAnswer, userAnswer) {
            const prompt = `You are a patient and encouraging mathematics teacher evaluating a Form 2 student's answer.

Question: ${question}
Hint: ${hint}
Correct Answer: ${correctAnswer}
Student's Answer: ${userAnswer}

CRITICAL INSTRUCTION: Be EXTREMELY FLEXIBLE and GENEROUS in accepting answers. Your goal is to recognize correct mathematical understanding regardless of format.

IMPORTANT: Students may write answers in WORDS (like "one over two", "half", "fifty percent") or NUMBERS (like "1/2", "0.5", "50%"). BOTH ARE EQUALLY VALID!

✅ ACCEPT ALL THESE VARIATIONS AS CORRECT:

1. NUMBERS - Accept ANY form:
   - Numeric: "3", "15", "100", "1.5", "0.5"
   - Written: "three", "fifteen", "one hundred", "one point five", "half"
   - Mixed: "1 and a half", "2 and three quarters"

2. FRACTIONS - Accept ALL representations:
   - Standard: "1/2", "3/4", "2/5"
   - Written: "one half", "three quarters", "two fifths", "one over two"
   - Decimal: "0.5", "0.75", "0.4"

3. PERCENTAGES - Accept ALL forms:
   - With symbol: "50%", "25%"
   - Without symbol: "50", "25"
   - Written: "fifty percent", "twenty-five percent"

Respond ONLY with valid JSON in this exact format:
{
  "isCorrect": true or false,
  "confidence": 0.95,
  "feedback": "Brief, encouraging feedback",
  "suggestions": ["suggestion 1", "suggestion 2"]
}`;

            const response = await fetch(
                `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${API_KEY}`,
                {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.3,
                            topK: 1,
                            topP: 1,
                            maxOutputTokens: 512,
                        }
                    }),
                }
            );

            const data = await response.json();
            const text = data.candidates[0].content.parts[0].text;
            const cleanText = text.replace(/```json\n?|\n?```/g, '').trim();
            return JSON.parse(cleanText);
        }

        async function testCase1() {
            const resultDiv = document.getElementById('result1');
            resultDiv.innerHTML = '<p class="loading">Testing...</p>';
            
            try {
                const result = await evaluateWithGemini(
                    'Convert 50% to a fraction in its simplest form.',
                    'Write the percentage as a fraction over 100, then simplify by dividing both numerator and denominator by their HCF.',
                    '1/2',
                    'one over two'
                );
                
                resultDiv.innerHTML = `
                    <div class="result ${result.isCorrect ? 'correct' : 'incorrect'}">
                        <p><strong>Result:</strong> ${result.isCorrect ? '✅ CORRECT' : '❌ INCORRECT'}</p>
                        <p><strong>Feedback:</strong> ${result.feedback}</p>
                        <p><strong>Confidence:</strong> ${result.confidence}</p>
                        ${result.suggestions ? `<p><strong>Suggestions:</strong> ${result.suggestions.join(', ')}</p>` : ''}
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<div class="result incorrect"><p>Error: ${error.message}</p></div>`;
            }
        }

        async function testCase2() {
            const resultDiv = document.getElementById('result2');
            resultDiv.innerHTML = '<p class="loading">Testing...</p>';
            
            try {
                const result = await evaluateWithGemini(
                    'Convert 50% to a fraction in its simplest form.',
                    'Write the percentage as a fraction over 100, then simplify by dividing both numerator and denominator by their HCF.',
                    '1/2',
                    'half'
                );
                
                resultDiv.innerHTML = `
                    <div class="result ${result.isCorrect ? 'correct' : 'incorrect'}">
                        <p><strong>Result:</strong> ${result.isCorrect ? '✅ CORRECT' : '❌ INCORRECT'}</p>
                        <p><strong>Feedback:</strong> ${result.feedback}</p>
                        <p><strong>Confidence:</strong> ${result.confidence}</p>
                        ${result.suggestions ? `<p><strong>Suggestions:</strong> ${result.suggestions.join(', ')}</p>` : ''}
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<div class="result incorrect"><p>Error: ${error.message}</p></div>`;
            }
        }

        async function testCase3() {
            const resultDiv = document.getElementById('result3');
            resultDiv.innerHTML = '<p class="loading">Testing...</p>';
            
            try {
                const result = await evaluateWithGemini(
                    'What is 50% as a percentage?',
                    'Just write the number with the percent symbol.',
                    '50%',
                    'fifty percent'
                );
                
                resultDiv.innerHTML = `
                    <div class="result ${result.isCorrect ? 'correct' : 'incorrect'}">
                        <p><strong>Result:</strong> ${result.isCorrect ? '✅ CORRECT' : '❌ INCORRECT'}</p>
                        <p><strong>Feedback:</strong> ${result.feedback}</p>
                        <p><strong>Confidence:</strong> ${result.confidence}</p>
                        ${result.suggestions ? `<p><strong>Suggestions:</strong> ${result.suggestions.join(', ')}</p>` : ''}
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<div class="result incorrect"><p>Error: ${error.message}</p></div>`;
            }
        }
    </script>
</body>
</html>
